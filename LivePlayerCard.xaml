<UserControl x:Class="MixOverlays.Views.LivePlayerCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:MixOverlays.Converters">

    <UserControl.Resources>
        <conv:BoolToVisibilityConverter             x:Key="BoolVis"/>
        <conv:InverseBoolToVisibilityConverter      x:Key="InvBoolVis"/>
        <conv:RankTierBrushConverter                x:Key="RankBrush"/>
        <conv:WinRateBrushConverter                 x:Key="WinRateBrush"/>
        <conv:PercentFormatConverter                x:Key="PctFmt"/>
        <conv:UrlToImageSourceWithFallbackConverter x:Key="UrlToImgWithFallback"/>
        <conv:ChampionNameToImageConverter          x:Key="ChampToImg"/>
        <conv:SummonerSpellIdToImageConverter       x:Key="SpellToImg"/>
    </UserControl.Resources>

    <Border Background="{StaticResource BgCardBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1" CornerRadius="8" Margin="0,0,0,6">
        <Grid>

            <!-- Skeleton chargement -->
            <StackPanel Visibility="{Binding IsLoading, Converter={StaticResource BoolVis}}"
                        Orientation="Horizontal" Margin="12,10" Opacity="0.5">
                <Border Width="40" Height="40" CornerRadius="6"
                        Background="{StaticResource BgSecondaryBrush}" Margin="0,0,8,0"/>
                <Border Width="40" Height="40" CornerRadius="20"
                        Background="{StaticResource BgSecondaryBrush}" Margin="0,0,10,0"/>
                <StackPanel VerticalAlignment="Center">
                    <Border Width="110" Height="10" CornerRadius="4"
                            Background="{StaticResource BgSecondaryBrush}" Margin="0,0,0,6"/>
                    <Border Width="75" Height="8" CornerRadius="4"
                            Background="{StaticResource BgSecondaryBrush}"/>
                </StackPanel>
            </StackPanel>

            <!-- Contenu chargÃ© -->
            <Grid Visibility="{Binding IsLoaded, Converter={StaticResource BoolVis}}"
                  Margin="12,9">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="52"/><!-- avatar + lvl -->
                    <ColumnDefinition Width="48"/><!-- champion -->
                    <ColumnDefinition Width="*"/> <!-- nom + summoners -->
                    <ColumnDefinition Width="Auto"/><!-- rang + stats -->
                </Grid.ColumnDefinitions>

                <!-- Avatar + badge niveau -->
                <Grid Grid.Column="0" Width="40" Height="40" Margin="0,0,10,0"
                      VerticalAlignment="Top">
                    <Border CornerRadius="20"
                            BorderBrush="{Binding SoloRank.tier, Converter={StaticResource RankBrush}}"
                            BorderThickness="2" ClipToBounds="True">
                        <Image Source="{Binding ProfileIconUrl, Converter={StaticResource UrlToImgWithFallback}}"
                               Stretch="UniformToFill"/>
                    </Border>
                    <!-- Niveau -->
                    <Border Background="#DD0D1117" CornerRadius="3"
                            Padding="4,1" HorizontalAlignment="Center"
                            VerticalAlignment="Bottom" Margin="0,0,0,-6">
                        <TextBlock Text="{Binding SummonerLevel}"
                                   Foreground="White" FontSize="9" FontWeight="Bold"
                                   HorizontalAlignment="Center"/>
                    </Border>
                </Grid>

                <!-- IcÃ´ne champion -->
                <Border Grid.Column="1" Width="40" Height="40"
                        CornerRadius="6" ClipToBounds="True" Margin="0,0,10,0">
                    <Image Source="{Binding ChampionName, Converter={StaticResource ChampToImg}}"
                           Stretch="UniformToFill"/>
                </Border>

                <!-- Nom + champion + summoners -->
                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="0,0,8,0">
                    <!-- Nom#TAG ou Mode Streamer -->
                    <StackPanel Orientation="Horizontal">
                        <!-- Nom normal -->
                        <TextBlock Text="{Binding GameName}"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   FontWeight="SemiBold" FontSize="13">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding GameName}" Value="">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text="#" Foreground="{StaticResource TextMutedBrush}"
                                   FontSize="11" Margin="2,1,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding GameName}" Value="">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text="{Binding TagLine}"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontSize="11" Margin="0,1,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding GameName}" Value="">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <!-- Mode streamer -->
                        <Border Background="#22F59E0B" CornerRadius="4" Padding="6,2">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding GameName}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸŽ¥" FontSize="10" Margin="0,0,4,0"/>
                                <TextBlock Text="Mode Streamer"
                                           Foreground="#F59E0B"
                                           FontSize="11" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Champion -->
                    <TextBlock Text="{Binding ChampionName}"
                               Foreground="#FF8C5A" FontSize="11" FontWeight="SemiBold"
                               Margin="0,2,0,4"/>

                    <!-- Summoners -->
                    <StackPanel Orientation="Horizontal">
                        <Border Width="20" Height="20" CornerRadius="3"
                                ClipToBounds="True" Margin="0,0,4,0"
                                Background="{StaticResource BgSecondaryBrush}">
                            <Image Source="{Binding LiveSpell1Id, Converter={StaticResource SpellToImg}}"
                                   Stretch="UniformToFill"/>
                        </Border>
                        <Border Width="20" Height="20" CornerRadius="3"
                                ClipToBounds="True"
                                Background="{StaticResource BgSecondaryBrush}">
                            <Image Source="{Binding LiveSpell2Id, Converter={StaticResource SpellToImg}}"
                                   Stretch="UniformToFill"/>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <!-- Rang + Win Rate + V/D -->
                <StackPanel Grid.Column="3" VerticalAlignment="Center"
                            HorizontalAlignment="Right">

                    <!-- Rang Solo -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock FontSize="12" FontWeight="Bold" Margin="0,0,5,0"
                                   Foreground="{Binding SoloRank.tier, Converter={StaticResource RankBrush}}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SoloRank}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                            <Run Text="{Binding SoloRank.tier, Mode=OneWay}"/>
                            <Run Text=" "/>
                            <Run Text="{Binding SoloRank.rank, Mode=OneWay}"/>
                        </TextBlock>
                        <TextBlock Text="{Binding SoloRank.leaguePoints, Mode=OneWay, StringFormat='{}{0} LP'}"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"
                                   VerticalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SoloRank}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBlock Text="Non classÃ©"
                                   Foreground="{StaticResource TextMutedBrush}" FontSize="11">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SoloRank}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>

                    <!-- Win Rate + V / D -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,3,0,0">
                        <TextBlock FontSize="11" FontWeight="SemiBold" Margin="0,0,6,0"
                                   Foreground="{Binding SoloWinRate, Converter={StaticResource WinRateBrush}}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SoloRank}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                            <Run Text="{Binding SoloWinRate, Converter={StaticResource PctFmt}, Mode=OneWay}"/>
                        </TextBlock>
                        <TextBlock FontSize="11">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SoloRank}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                            <Run Text="{Binding SoloWins, Mode=OneWay}" Foreground="#4ADE80"/>
                            <Run Text="V  " Foreground="#4ADE80"/>
                            <Run Text="{Binding SoloLosses, Mode=OneWay}" Foreground="#F87171"/>
                            <Run Text="D" Foreground="#F87171"/>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>

            </Grid>
        </Grid>
    </Border>
</UserControl>
