<!--
    OverlayWindow.xaml — Overlay in-game MixOverlays
    ▸ Togglable via Ctrl+X (global hotkey enregistré dans MainWindow.xaml.cs)
    ▸ Affiche 2 rangées de cartes losange : alliés (haut) / ennemis (bas)
    ▸ Transparent, toujours au-dessus, déplaçable par drag
-->
<Window x:Class="MixOverlays.Views.OverlayWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:MixOverlays.Views"
        Title="MixOverlays Overlay"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        Topmost="True"
        ResizeMode="NoResize"
        SizeToContent="WidthAndHeight"
        ShowInTaskbar="False"
        Focusable="False"
        KeyDown="Overlay_KeyDown">

    <Window.Resources>
        <!-- Bouton discret (fermeture) -->
        <Style x:Key="GhostButton" TargetType="Button">
            <Setter Property="Background"   Value="Transparent"/>
            <Setter Property="Foreground"   Value="#80FFFFFF"/>
            <Setter Property="BorderBrush"  Value="#30FFFFFF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding"      Value="6,3"/>
            <Setter Property="FontSize"     Value="11"/>
            <Setter Property="Cursor"       Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#30FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!--
        Conteneur principal : fond très légèrement sombre arrondi.
        MouseLeftButtonDown => DragMove pour déplacer la fenêtre.
    -->
    <Border Background="#CC0A0E1A"
            BorderBrush="#30FFFFFF" BorderThickness="1"
            CornerRadius="14"
            Padding="14,10"
            MouseLeftButtonDown="Overlay_MouseLeftButtonDown">

        <StackPanel>

            <!-- ── Barre de titre compacte ── -->
            <Grid Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Logo / indicateur -->
                    <Ellipse Width="8" Height="8" Fill="#4DC7DB" Margin="0,0,6,0"
                             VerticalAlignment="Center"/>
                    <TextBlock Text="MixOverlays"
                               Foreground="#80FFFFFF" FontSize="11" FontWeight="SemiBold"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="  ·  Ctrl+X pour masquer"
                               Foreground="#40FFFFFF" FontSize="10"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <Button Grid.Column="1"
                        Content="✕" Style="{StaticResource GhostButton}"
                        Click="CloseOverlay_Click"
                        ToolTip="Masquer l'overlay (Ctrl+X)"/>
            </Grid>

            <!-- ── Séparateur ── -->
            <Rectangle Height="1" Fill="#20FFFFFF" Margin="0,0,0,10"/>

            <!-- ══════════════════════════════════════════════════════════ -->
            <!--  RANGÉE ALLIÉS                                             -->
            <!-- ══════════════════════════════════════════════════════════ -->
            <StackPanel Margin="0,0,0,4">
                <TextBlock Text="A L L I É S" Foreground="#4DC7DB"
                           FontSize="9" FontWeight="Bold"
                           Margin="4,0,0,6"/>

                <ItemsControl x:Name="AllyList">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <!-- FIX : Margin positif pour éviter la superposition des fiches -->
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!-- FIX : était Margin="-10,0" qui causait un chevauchement de 20px -->
                            <views:DiamondPlayerCard DataContext="{Binding}"
                                                     Margin="2,0"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- ── Séparateur milieu ── -->
            <Rectangle Height="1" Fill="#15FFFFFF" Margin="0,2,0,2"/>

            <!-- ══════════════════════════════════════════════════════════ -->
            <!--  RANGÉE ENNEMIS                                            -->
            <!-- ══════════════════════════════════════════════════════════ -->
            <StackPanel Margin="0,4,0,0">
                <TextBlock Text="E N N E M I S" Foreground="#FF6B6B"
                           FontSize="9" FontWeight="Bold"
                           Margin="4,0,0,6"/>

                <ItemsControl x:Name="EnemyList">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!-- FIX : était Margin="-10,0" qui causait un chevauchement de 20px -->
                            <views:DiamondPlayerCard DataContext="{Binding}"
                                                     Margin="2,0"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

        </StackPanel>
    </Border>
</Window>
