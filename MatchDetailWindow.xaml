<Window x:Class="MixOverlays.Views.MatchDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:MixOverlays.Converters"
        Title="Détail de la partie"
        Width="1060" Height="680"
        MinWidth="860" MinHeight="500"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <conv:BoolToVisibilityConverter         x:Key="BoolToVis"/>
        <conv:InverseBoolToVisibilityConverter  x:Key="InvBoolToVis"/>
        <conv:WinLossBrushConverter             x:Key="WinLossBrush"/>
        <conv:KdaBrushConverter                 x:Key="KdaBrush"/>
        <conv:RankTierBrushConverter            x:Key="RankTierBrush"/>
        <conv:GameDurationConverter             x:Key="GameDuration"/>
        <conv:TimeAgoConverter                  x:Key="TimeAgo"/>
        <conv:ChampionNameToImageConverter      x:Key="ChampToImg"/>
        <conv:SummonerSpellIdToImageConverter   x:Key="SpellToImg"/>
        <conv:NullToVisibilityConverter         x:Key="NullToVis"/>
    </Window.Resources>

    <Border Background="#0D1117"
            BorderBrush="#30363D"
            BorderThickness="1"
            CornerRadius="10">
        <Border.Effect>
            <DropShadowEffect Color="#000000" BlurRadius="40" ShadowDepth="0" Opacity="0.8"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="38"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- ═══ Barre de titre ═══ -->
            <Border Grid.Row="0"
                    Background="#161B22"
                    CornerRadius="10,10,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                    Cursor="SizeAll">
                <Grid Margin="16,0,12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Mode de jeu -->
                    <Border Grid.Column="0"
                            Background="#21262D"
                            CornerRadius="4"
                            Padding="8,3"
                            VerticalAlignment="Center"
                            Margin="0,0,10,0">
                        <TextBlock Text="{Binding QueueName}"
                                   Foreground="#58A6FF"
                                   FontSize="12" FontWeight="Bold"/>
                    </Border>

                    <!-- Durée + date -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Foreground="#8B949E" FontSize="13" VerticalAlignment="Center">
                            <Run Text="{Binding DurationDisplay, Mode=OneWay}"/>
                        </TextBlock>
                        <TextBlock Text=" · " Foreground="#444D56" FontSize="13" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding GameCreation, Converter={StaticResource TimeAgo}}"
                                   Foreground="#6B7280" FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Indicateur chargement rangs -->
                    <Border Grid.Column="2"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Background="#1C2128"
                            CornerRadius="4"
                            Padding="8,3"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                        <TextBlock Text="&#x23F3; Chargement des rangs..."
                                   Foreground="#F59E0B"
                                   FontSize="11"/>
                    </Border>

                    <!-- Bouton fermer -->
                    <Button Grid.Column="3"
                            Content="&#x2715;"
                            Click="CloseButton_Click"
                            VerticalAlignment="Center"
                            Width="30" Height="30"
                            Cursor="Hand"
                            Foreground="#6B7280"
                            FontSize="14">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="5"
                                                    Width="28" Height="28">
                                                <ContentPresenter HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#DA3633"/>
                                                    <Setter Property="Foreground"  Value="White"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>

            <!-- ═══ En-têtes des équipes ═══ -->
            <Grid Grid.Row="1" Margin="14,4,14,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="36"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0"
                        Background="#0D2137"
                        BorderBrush="#1F6FEB"
                        BorderThickness="1,1,1,0"
                        CornerRadius="6,6,0,0"
                        Padding="0,5">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="&#x1F3C6; " FontSize="13"/>
                        <TextBlock Text="VICTOIRE"
                                   Foreground="#3FB950"
                                   FontSize="12" FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2"
                        Background="#2D0F0F"
                        BorderBrush="#F85149"
                        BorderThickness="1,1,1,0"
                        CornerRadius="6,6,0,0"
                        Padding="0,5">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="&#x1F480; " FontSize="13"/>
                        <TextBlock Text="DÉFAITE"
                                   Foreground="#F85149"
                                   FontSize="12" FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- ═══ Liste des joueurs ═══ -->
            <ScrollViewer Grid.Row="2"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Padding="14,0,14,14">
	<Grid>
                <!-- État chargement initial -->
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Margin="0,60,0,0"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="&#x23F3;"
                               FontSize="36"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10"/>
                    <TextBlock Text="Chargement de la partie..."
                               Foreground="#8B949E"
                               FontSize="14"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Tableau face-à-face -->
                <ItemsControl ItemsSource="{Binding PlayerRows}"
                              Visibility="{Binding IsLoading, Converter={StaticResource InvBoolToVis}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!-- Une ligne = 1 joueur victoire vs 1 joueur défaite -->
                            <Grid Margin="0,3,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="36"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- ══ Joueur VICTOIRE (gauche, fond bleu) ══ -->
                                <Border Grid.Column="0"
                                        Background="#0A1628"
                                        BorderBrush="#1F3A5F"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Padding="10,7"
                                        Visibility="{Binding BluePlayer, Converter={StaticResource NullToVis}}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="40"/>
                                            <ColumnDefinition Width="20"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="70"/>
                                            <ColumnDefinition Width="48"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Icône champion -->
                                        <Border Grid.Column="0"
                                                Width="36" Height="36"
                                                CornerRadius="4"
                                                Margin="0,0,6,0"
                                                VerticalAlignment="Center">
                                            <Border.Background>
                                                <ImageBrush ImageSource="{Binding BluePlayer.ChampionName, Converter={StaticResource ChampToImg}}"
                                                            Stretch="UniformToFill"/>
                                            </Border.Background>
                                        </Border>

                                        <!-- Sorts d'invocateur -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,6,0">
                                            <Image Width="15" Height="15" Margin="0,0,0,2"
                                                   Source="{Binding BluePlayer.Summoner1Id, Converter={StaticResource SpellToImg}}"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                            <Image Width="15" Height="15"
                                                   Source="{Binding BluePlayer.Summoner2Id, Converter={StaticResource SpellToImg}}"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                        </StackPanel>

                                        <!-- Nom + rang -->
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="0,0,8,0">
                                            <TextBlock Text="{Binding BluePlayer.DisplayName}"
                                                       Foreground="#E6EDF3"
                                                       FontSize="12" FontWeight="SemiBold"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                <TextBlock Text="{Binding BluePlayer.RankDisplay}"
                                                           FontSize="10"
                                                           Foreground="{Binding BluePlayer.Tier, Converter={StaticResource RankTierBrush}}"/>
                                                <TextBlock Text="{Binding BluePlayer.LpDisplay}"
                                                           FontSize="10"
                                                           Foreground="#6B7280"
                                                           Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- KDA -->
                                        <StackPanel Grid.Column="3" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <TextBlock HorizontalAlignment="Center" FontSize="12">
                                                <Run Text="{Binding BluePlayer.Kills}"   Foreground="#E6EDF3" FontWeight="SemiBold"/>
                                                <Run Text="/"  Foreground="#444D56"/>
                                                <Run Text="{Binding BluePlayer.Deaths}"  Foreground="#F85149" FontWeight="SemiBold"/>
                                                <Run Text="/"  Foreground="#444D56"/>
                                                <Run Text="{Binding BluePlayer.Assists}" Foreground="#8B949E" FontWeight="SemiBold"/>
                                            </TextBlock>
                                            <TextBlock Text="{Binding BluePlayer.KDA, StringFormat={}{0:F2} KDA, Mode=OneWay}"
                                                       FontSize="10"
                                                       Foreground="{Binding BluePlayer.KDA, Converter={StaticResource KdaBrush}}"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,1,0,0"/>
                                        </StackPanel>

                                        <!-- CS -->
                                        <StackPanel Grid.Column="4" VerticalAlignment="Center" HorizontalAlignment="Right">
                                            <TextBlock Text="{Binding BluePlayer.CS, StringFormat={}{0} CS}"
                                                       Foreground="#8B949E"
                                                       FontSize="11"
                                                       HorizontalAlignment="Right"/>
                                            <TextBlock Text="{Binding BluePlayer.ChampionName}"
                                                       Foreground="#444D56"
                                                       FontSize="9"
                                                       HorizontalAlignment="Right"
                                                       TextTrimming="CharacterEllipsis"
                                                       Margin="0,1,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- Séparateur VS -->
                                <TextBlock Grid.Column="1"
                                           Text="VS"
                                           Foreground="#444D56"
                                           FontSize="10" FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>

                                <!-- ══ Joueur DÉFAITE (droite, fond rouge) ══ -->
                                <Border Grid.Column="2"
                                        Background="#160A0A"
                                        BorderBrush="#5F1F1F"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Padding="10,7"
                                        Visibility="{Binding RedPlayer, Converter={StaticResource NullToVis}}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="48"/>
                                            <ColumnDefinition Width="70"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="20"/>
                                            <ColumnDefinition Width="40"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- CS (mirroir) -->
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Left">
                                            <TextBlock Text="{Binding RedPlayer.CS, StringFormat={}{0} CS}"
                                                       Foreground="#8B949E"
                                                       FontSize="11"/>
                                            <TextBlock Text="{Binding RedPlayer.ChampionName}"
                                                       Foreground="#444D56"
                                                       FontSize="9"
                                                       TextTrimming="CharacterEllipsis"
                                                       Margin="0,1,0,0"/>
                                        </StackPanel>

                                        <!-- KDA -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <TextBlock HorizontalAlignment="Center" FontSize="12">
                                                <Run Text="{Binding RedPlayer.Kills}"   Foreground="#E6EDF3" FontWeight="SemiBold"/>
                                                <Run Text="/"  Foreground="#444D56"/>
                                                <Run Text="{Binding RedPlayer.Deaths}"  Foreground="#F85149" FontWeight="SemiBold"/>
                                                <Run Text="/"  Foreground="#444D56"/>
                                                <Run Text="{Binding RedPlayer.Assists}" Foreground="#8B949E" FontWeight="SemiBold"/>
                                            </TextBlock>
                                            <TextBlock Text="{Binding RedPlayer.KDA, StringFormat={}{0:F2} KDA, Mode=OneWay}"
                                                       FontSize="10"
                                                       Foreground="{Binding RedPlayer.KDA, Converter={StaticResource KdaBrush}}"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,1,0,0"/>
                                        </StackPanel>

                                        <!-- Nom + rang -->
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center"
                                                    HorizontalAlignment="Right" Margin="8,0,6,0">
                                            <TextBlock Text="{Binding RedPlayer.DisplayName}"
                                                       Foreground="#E6EDF3"
                                                       FontSize="12" FontWeight="SemiBold"
                                                       TextTrimming="CharacterEllipsis"
                                                       HorizontalAlignment="Right"/>
                                            <StackPanel Orientation="Horizontal"
                                                        HorizontalAlignment="Right"
                                                        Margin="0,2,0,0">
                                                <TextBlock Text="{Binding RedPlayer.LpDisplay}"
                                                           FontSize="10"
                                                           Foreground="#6B7280"
                                                           Margin="0,0,4,0"/>
                                                <TextBlock Text="{Binding RedPlayer.RankDisplay}"
                                                           FontSize="10"
                                                           Foreground="{Binding RedPlayer.Tier, Converter={StaticResource RankTierBrush}}"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Sorts d'invocateur -->
                                        <StackPanel Grid.Column="3" VerticalAlignment="Center" Margin="0,0,6,0">
                                            <Image Width="15" Height="15" Margin="0,0,0,2"
                                                   Source="{Binding RedPlayer.Summoner1Id, Converter={StaticResource SpellToImg}}"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                            <Image Width="15" Height="15"
                                                   Source="{Binding RedPlayer.Summoner2Id, Converter={StaticResource SpellToImg}}"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                        </StackPanel>

                                        <!-- Icône champion -->
                                        <Border Grid.Column="4"
                                                Width="36" Height="36"
                                                CornerRadius="4"
                                                VerticalAlignment="Center">
                                            <Border.Background>
                                                <ImageBrush ImageSource="{Binding RedPlayer.ChampionName, Converter={StaticResource ChampToImg}}"
                                                            Stretch="UniformToFill"/>
                                            </Border.Background>
                                        </Border>
                                    </Grid>
                                </Border>

                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
		</Grid>
            </ScrollViewer>

        </Grid>
    </Border>
</Window>
